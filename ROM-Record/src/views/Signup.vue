<!-- Signup page, should be redirected from login later -->

<script>
    import { ref } from "vue";
    let input = ref("");

    // Fadak's code, implements firebase auth
    import { auth, db } from '../firebaseResources';
    import { doc, setDoc } from "firebase/firestore"; 
    import { createUserWithEmailAndPassword } from 'firebase/auth';
    import { useAuthStore } from "../stores/authStore";

    export default{
        data(){
            return{
                //loggedIn: false,
                user: {
                    email: null,
                    password: null,
                    name: null,
                },
                backlog: {
                    unplayed: {
                          //holds unplayed games
                    },
                    played: {
                          //holds played games
                    },
                    beaten: {
                          //holds beaten games
                    },
                    completed: {
                          //holds completed games
                    },
                  },
                authStore: useAuthStore(),
            }
        },
        mounted(){
                auth.onAuthStateChanged((user) =>{
                    if(user){
                        this.authStore.setUser(user.email);
                    }
                    else{
                        this.authStore.setUser(null);
                    }
                })
            },
        methods:{
            async createAccount(){
                try{
                    console.log('creating...');
                    const userCredentials = await createUserWithEmailAndPassword(auth, this.user.email, this.user.password);
                    console.log('account created!');
                    this.authStore.setUser(this.user);
                    const uid = userCredentials.user.uid;
                    await setDoc(doc(db, 'users', uid), this.user);
                    await setDoc(doc(db, 'users', uid, 'backlog', this.user.name + "\'s backlog"), this.backlog);
                    console.log('Current user', auth.currentUser);
                }
                catch(err){
                    console.error('Couldn\'t create account', err);
                }
            }
        }
    }
</script>

<template>
    <div class="Signup">
        <title>Signup</title>
        <header>Create an account!</header>

        <div class="wrapper">
            <input type="text" v-model="user.name" placeholder="Username"/>
            <input type="text" v-model="user.email" placeholder="Email"/>
            <input type="password" v-model="user.password" placeholder="Password"/>
            <RouterLink to="/Login"><button @click="createAccount()">Create Account</button></RouterLink>
        </div>
    </div>
</template>

<style scoped>
input {
    display: block;
    width: 350px;
    margin: 20px auto;
    padding: 1px 45px;
    background-size: 15px 15px;
    font-size: 16px;
    border: none;
    border-radius: 5px;
    
  }
header {
    text-align: center;
}
</style>